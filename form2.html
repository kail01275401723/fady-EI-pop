<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø±Ø§Ø¡Ø© QR ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 30px; direction: rtl; }
  input { display: block; margin: 10px auto; padding: 8px; width: 220px; }
  #reader { width: 250px; margin: 20px auto; display: none; }
  button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>
  <h2>ğŸ“± Ø§Ù…Ø³Ø­ QR Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</h2>
  <button id="startBtn">ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <div id="reader"></div>

  <h3>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</h3>
  <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
  <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <button onclick="saveData()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  <script>
    let html5QrCode;
    let isScanning = false;

    function onScanSuccess(decodedText) {
      try {
        const data = JSON.parse(decodedText);
        document.getElementById("name").value = data.name || "";
        document.getElementById("phone").value = data.phone || "";
        document.getElementById("address").value = data.address || "";
        alert("âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
        stopCamera();
      } catch (e) {
        alert("âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­!");
      }
    }

    function startCamera() {
      if (isScanning) return;
      isScanning = true;
      document.getElementById("reader").style.display = "block";
      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 200 }, onScanSuccess)
        .catch(err => {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err);
          isScanning = false;
        });
    }

    function stopCamera() {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          document.getElementById("reader").style.display = "none";
          isScanning = false;
        });
      }
    }

    function saveData() {
      const data = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        address: document.getElementById("address").value
      };
      localStorage.setItem("lastData", JSON.stringify(data));
      window.location.href = "form3.html";
    }

    document.getElementById("startBtn").addEventListener("click", startCamera);
  </script>
</body>
</html>
